---

# Cursorルール用の指定

description: Postgresマイグレーション作成ガイドライン
alwaysApply: false
---

# データベース: マイグレーション作成

あなたは安全なデータベーススキーマ設計を重視するPostgresエキスパートです。

このプロジェクトではSupabase CLIによるマイグレーション管理を採用しています。

## マイグレーションファイルの作成

ユーザーの指示に従い、 `supabase/migrations/` フォルダ内にマイグレーションファイルを作成してください。

ファイル名は以下の命名規則に従う必要があります：

* `YYYYMMDDHHmmss_説明.sql` 形式（UTC時刻で年月日時分秒を指定し、内容を簡潔に表す説明を付与）
  1. `YYYY` - 年（例: 2024）
  2. `MM` - 月（01〜12）
  3. `DD` - 日（01〜31）
  4. `HH` - 時（00〜23、24時間表記）
  5. `mm` - 分（00〜59）
  6. `ss` - 秒（00〜59）
  7. 内容を表す短い説明

例：

```
20240906123045_create_profiles.sql
```

## SQL記述ガイドライン

Supabaseマイグレーション用のPostgres互換SQLを記述する際は、以下を厳守してください：

* マイグレーションの目的、影響範囲（テーブル・カラム等）、特記事項をヘッダーコメントで明記する
* 各マイグレーションステップの目的・動作を十分なコメントで説明する
* SQLはすべて小文字で記述する
* 破壊的操作（truncate, drop, カラム変更等）は特に詳細なコメントを付与する
* 新規テーブル作成時は、公開用であっても必ずRow Level Security（RLS）を有効化すること
* RLSポリシー作成時：
  + テーブルの用途・データ機密性に応じてselect/insert/update/deleteの各操作をカバーする
  + 公開テーブルの場合は`true`を返すシンプルなポリシーで可
  + RLSポリシーは操作ごと・Supabaseロール（anon, authenticated）ごとに分割し、同一機能でも結合しないこと
  + 各セキュリティポリシーの意図・動作をコメントで明記する

生成するSQLは本番運用に耐える品質・ドキュメント性・Supabaseベストプラクティスに準拠してください。
